/*! jQuery WriteAndTag v0.1.0 (beta) | https://github.com/czuddas/jQuery-WriteAndTag | 2020-12-24 */
var WriteAndTag=function(){var a=null,u=null,i="&nbsp;",e=!0,n=!1,o=null,l=null,r=function(t){"object"==typeof t&&(a=t,d())},c=function(t){"string"==typeof t&&$(t).length&&(u=t,$(t).attr("contentEditable",!0),d())},s=function(t){"boolean"==typeof t&&(e=t)},f=function(t){"string"==typeof t&&(i=t.replace(/\s/g,"&nbsp;"))},t,p=function(){return A()},g=function(){var t=[],n=A(),e="<span",o="</span>",a,r,u,i;do{var l=!1,c=n.indexOf(e),s="",f,s,n,s}while(n=0===c?(f=n.indexOf(o),s=n.substr(0,f+o.length),n.substr(f+o.length)):0<c?(s=n.substr(0,c),n.substr(c)):(s=n,""),s.length&&(s={plainText:s},t.push(s),l=!0),l);for(a in t){0===t[a].plainText.indexOf(e)&&(u=(r=$(t[a].plainText)).data("writeandtag-tag"),i=r.data("writeandtag-value"),t[a].tag={char:u,value:i,fullTag:r.html()},t[a].plainText=r.html().substr(1))}return t},d=function(){"object"==typeof a&&"string"==typeof u&&h()},h=function(){$(u).keydown(function(t){"tab"===t.key.toLowerCase()&&$(this).data("ui-autocomplete").menu.active||v(t,this)}),$(u).keyup(function(t){S(t)||D(t)||O(t)||($(u).html(A(!1)),R(this))}),$(u).on("paste",function(t){return t.preventDefault(),!1})},v=function(t,r){var n;"string"!=typeof t.key||"string"==typeof(n=t.key)&&1===n.length&&(T(n)?(t.preventDefault(),C(!0),$(u).append('<span data-writeandtag="true">'+n+"</span>"),R(r),w(n)):x(n)&&(t.preventDefault(),content=$(u).html()+"&nbsp;",$(u).html(content),R(r),C(!1),w(null)),L()&&null!=o&&(j($(u+" span").last(),n,t),$(u).autocomplete({minLength:0,source:function(t,n){n($.ui.autocomplete.filter(o,l))},focus:function(t,n){return!1},select:function(t,n){var e=$(u+" span").last(),o,a=(o=e.html()).substr(0,1),o=a+n.item.label;return e.attr("data-writeandtag-tag",a),e.attr("data-writeandtag-value",n.item.value),e.html(o),i.length&&$(u).append(i),R(r),C(!1),$(u).autocomplete("destroy"),!1}}).autocomplete("instance")._renderItem=function(t,n){return $("<li>").append("<div>"+n.label+"</div>").appendTo(t)}))},m=function(t){var n=null,e;for(e in a){var o=a[e];if("string"==typeof o.tag&&o.tag===t){n=o;break}}return n},b=function(t){var n=null,t=m(t);return null!==t&&"object"==typeof t.autocomplete&&(n=t.autocomplete,e&&(n=y(n))),n},y=function(t){return null!==t&&"object"==typeof t&&t.length&&t.sort(function(t,n){var t=t.label.toLowerCase(),n=n.label.toLowerCase();return t<n?-1:n<t?1:0}),t},w=function(t){null==t?o=null:"string"==typeof t&&1===t.length&&(o=b(t))},T=function(t){return!L()&&k(t)},x=function(t){return L()&&" "===t},k=function(t){return null!==m(t)},C=function(t){"boolean"==typeof t&&(n=t)},L=function(){return n},R=function(t){var n,e,n;t.focus(),void 0!==window.getSelection&&void 0!==document.createRange?((n=document.createRange()).selectNodeContents(t),n.collapse(!1),(e=window.getSelection()).removeAllRanges(),e.addRange(n)):void 0!==document.body.createTextRange&&((n=document.body.createTextRange()).moveToElementText(t),n.collapse(!1),n.select())},j=function(t,n,e){var t;l="",t.length&&(t=t.html(),l=t.substring(1),O(e)?l=l.substring(0,l.length-1):k(n)||(l+=n))},O=function(t){return"backspace"===t.key.toLowerCase()},S=function(t){return"shift"===t.key.toLowerCase()},D=function(t){return 0===t.key.toLowerCase().indexOf("arrow")},A=function(t){var n="<div>"+$(".container").html()+"</div>",n=$(n);n.find("*").not("span[data-writeandtag='true']:not(:empty)").each(function(){$(this).replaceWith(this.innerHTML)});var n,n=(n=n.html()).replace(/\n/g,"");return void 0!==t&&!t||(n=n.replace(/(&nbsp;)/g," ")),n};return{setTags:function(t){r(t)},setContainer:function(t){c(t)},setSorting:function(t){s(t)},setTagSeparator:function(t){f(t)},getPlainText:function(){return $(u).text()},getHtml:function(){return A()},getJson:g}};